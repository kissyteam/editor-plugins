define("kg/editor-plugins/1.1.7/image",["./button","editor","./bubble","./contextmenu","./dialog-loader","util","ua","node"],function(e,t,n){function i(e){this.config=e||{}}e("./button");var o=e("editor");e("./bubble"),e("./contextmenu");var l=e("./dialog-loader"),r=e("util"),a=e("ua"),c=e("node"),d=function(e){return e=c(e),"img"!==e.nodeName()||/(^|\s+)ke_/.test(e[0].className)?void 0:e},s='<a class="{prefixCls}editor-bubble-url" target="_blank" href="#">在新窗口查看</a>  |  <a class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-change" href="#">编辑</a>  |  <a class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-remove" href="#">删除</a>';i.prototype={pluginRenderUI:function(e){function t(t){l.useDialog(e,"image",n.config,t)}var n=this,i=e.get("prefixCls");e.addButton("image",{tooltip:"插入图片",listeners:{click:function(){t(null)}},mode:o.Mode.WYSIWYG_MODE});var u=[{content:"图片属性",fn:function(){var e=d(this.get("editorSelectedEl"));e&&(this.hide(),t(c(e)))}},{content:"插入新行",fn:function(){this.hide();var t=e.get("document")[0],n=c(t.createElement("p"));a.ie||n._4eAppendBogus(void 0);var i=new o.Range(t);i.setStartAfter(this.get("editorSelectedEl")),i.select(),e.insertElement(n),i.moveToElementEditablePosition(n,1),i.select()}}],b=[];r.each(u,function(e){b.push({content:e.content})}),e.addContextMenu("image",d,{width:120,children:b,listeners:{click:function(e){var t=this,n=e.target.get("content");r.each(u,function(e){e.content===n&&e.fn.call(t)})}}}),e.docReady(function(){e.get("document").on("dblclick",function(e){e.halt();var n=c(e.target);d(n)&&t(n)})}),e.addBubble("image",d,{listeners:{afterRenderUI:function(){var n=this,l=n.get("contentEl");l.html(r.substitute(s,{prefixCls:i}));var c=l.one("."+i+"editor-bubble-url"),d=l.one("."+i+"editor-bubble-change"),u=l.one("."+i+"editor-bubble-remove");o.Utils.preventFocus(l),d.on("click",function(e){t(n.get("editorSelectedEl")),e.halt()}),u.on("click",function(t){if(a.webkit){var i=e.getSelection().getRanges();i&&i[0]&&(i[0].collapse(),i[0].select())}n.get("editorSelectedEl").remove(),n.hide(),e.notifySelectionChange(),t.halt()}),n.on("show",function(){var e=n.get("editorSelectedEl");if(e){var t=e.attr("_ke_saved_src")||e.attr("src");c.attr("href",t)}})}}})}},n.exports=i});