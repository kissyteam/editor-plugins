KISSY.add('kg/editor-plugins/1.1.2/flash-common/base-class',["./utils","base","editor","node","ua","util","../dialog-loader","../bubble","../contextmenu"],function(S ,require, exports, module) {var e=require("./utils"),t=require("base"),i=require("editor"),l=require("node"),n=require("ua"),r=require("util"),o=require("../dialog-loader");require("../bubble"),require("../contextmenu");var a=' <a class="{prefixCls}editor-bubble-url" target="_blank" href="#">{label}</a>   |    <span class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-change">编辑</span>   |    <span class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-remove">删除</span>';module.exports=t.extend({initializer:function(){var e=this,t=e.get("cls"),l=e.get("editor"),o=l.get("prefixCls"),u=[],s=e.get("bubbleId"),c=e.get("contextMenuId"),d=e.get("contextMenuHandlers");r.each(d,function(e,t){u.push({content:t})}),l.addContextMenu(c,"."+t,{width:"120px",children:u,listeners:{click:function(e){var t=e.target.get("content");d[t]&&d[t].call(this)}}}),l.addBubble(s,function(e){return e.hasClass(t,void 0)&&e},{listeners:{afterRenderUI:function(){var t=this,u=t.get("contentEl");u.html(r.substitute(a,{label:e.get("label"),prefixCls:o}));var s=u.one("."+o+"editor-bubble-url"),c=u.one("."+o+"editor-bubble-change"),d=u.one("."+o+"editor-bubble-remove");i.Utils.preventFocus(u),c.on("click",function(i){e.show(t.get("editorSelectedEl")),i.halt()}),d.on("click",function(e){if(n.webkit){var i=l.getSelection().getRanges(),r=i&&i[0];r&&(r.collapse(!0),r.select())}t.get("editorSelectedEl").remove(),t.hide(),l.notifySelectionChange(),e.halt()}),t.on("show",function(){var i=t.get("editorSelectedEl");i&&e._updateTip(s,i)})}}}),l.docReady(function(){l.get("document").on("dblclick",e._dbClick,e)})},_getFlashUrl:function(t){return e.getUrl(t)},_updateTip:function(e,t){var i=this,l=i.get("editor"),n=l.restoreRealElement(t);if(n){var r=i._getFlashUrl(n);e.attr("href",r)}},_dbClick:function(e){var t=this,i=l(e.target);"img"===i.nodeName()&&i.hasClass(t.get("cls"),void 0)&&(t.show(i),e.halt())},show:function(e){var t=this,i=t.get("editor");o.useDialog(i,t.get("type"),t.get("pluginConfig"),e)}},{ATTRS:{cls:{},type:{},label:{value:"在新窗口查看"},bubbleId:{},contextMenuId:{},contextMenuHandlers:{}}});});