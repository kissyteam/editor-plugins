define("kg/editor-plugins/1.1.6/flash-common/base-class",["./utils","base","editor","node","ua","util","../dialog-loader","../bubble","../contextmenu"],function(e,t,l){var n=e("./utils"),i=e("base"),o=e("editor"),a=e("node"),r=e("ua"),s=e("util"),c=e("../dialog-loader");e("../bubble"),e("../contextmenu");var u=' <a class="{prefixCls}editor-bubble-url" target="_blank" href="#">{label}</a>   |    <span class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-change">编辑</span>   |    <span class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-remove">删除</span>';l.exports=i.extend({initializer:function(){var e=this,t=e.get("cls"),l=e.get("editor"),n=l.get("prefixCls"),i=[],a=e.get("bubbleId"),c=e.get("contextMenuId"),d=e.get("contextMenuHandlers");s.each(d,function(e,t){i.push({content:t})}),l.addContextMenu(c,"."+t,{width:"120px",children:i,listeners:{click:function(e){var t=e.target.get("content");d[t]&&d[t].call(this)}}}),l.addBubble(a,function(e){return e.hasClass(t,void 0)&&e},{listeners:{afterRenderUI:function(){var t=this,i=t.get("contentEl");i.html(s.substitute(u,{label:e.get("label"),prefixCls:n}));var a=i.one("."+n+"editor-bubble-url"),c=i.one("."+n+"editor-bubble-change"),d=i.one("."+n+"editor-bubble-remove");o.Utils.preventFocus(i),c.on("click",function(l){e.show(t.get("editorSelectedEl")),l.halt()}),d.on("click",function(e){if(r.webkit){var n=l.getSelection().getRanges(),i=n&&n[0];i&&(i.collapse(!0),i.select())}t.get("editorSelectedEl").remove(),t.hide(),l.notifySelectionChange(),e.halt()}),t.on("show",function(){var l=t.get("editorSelectedEl");l&&e._updateTip(a,l)})}}}),l.docReady(function(){l.get("document").on("dblclick",e._dbClick,e)})},_getFlashUrl:function(e){return n.getUrl(e)},_updateTip:function(e,t){var l=this,n=l.get("editor"),i=n.restoreRealElement(t);if(i){var o=l._getFlashUrl(i);e.attr("href",o)}},_dbClick:function(e){var t=this,l=a(e.target);"img"===l.nodeName()&&l.hasClass(t.get("cls"),void 0)&&(t.show(l),e.halt())},show:function(e){var t=this,l=t.get("editor");c.useDialog(l,t.get("type"),t.get("pluginConfig"),e)}},{ATTRS:{cls:{},type:{},label:{value:"在新窗口查看"},bubbleId:{},contextMenuId:{},contextMenuHandlers:{}}})});