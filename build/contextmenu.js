KISSY.add('kg/editor-plugins/1.1.0/contextmenu',["editor","menu","./focus-fix","event/dom","node"],function(S ,require, exports, module) {var e=require("editor"),t=require("menu"),n=require("./focus-fix"),o=require("event/dom"),i=require("node");e.prototype.addContextMenu=function(r,u,d){function c(t){var n=i(t.target),o=t.pageX,r=t.pageY;if(o){var u=e.Utils.getXY({left:o,top:r},f);o=u.left,r=u.top,setTimeout(function(){s.set("editorSelectedEl",n,{silent:1}),s.move(o,r),f.fire("contextmenu",{contextmenu:s}),s.show(),window.focus(),document.body.focus(),s.focus()},30)}}var f=this;d=d||{};var a=d.event;a&&delete d.event,d.prefixCls=f.get("prefixCls")+"editor-",d.editor=f,d.focusable=1,d.zIndex=e.baseZIndex(e.ZIndexManager.POPUP_MENU);var s=new t.PopupMenu(d);return n.init(s),s.on("afterRenderUI",function(){s.get("el").on("keydown",function(e){e.keyCode===o.KeyCode.ESC&&s.hide()})}),f.docReady(function(){var e=f.get("document");e.on("mousedown",function(e){1===e.which&&s.hide()}),e.delegate("contextmenu",u,function(e){e.halt(),c(e)})}),a&&c(a),f.addControl(r+"/contextmenu",s),s};});