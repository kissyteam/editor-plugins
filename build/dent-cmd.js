KISSY.add('kg/editor-plugins/1.1.0/dent-cmd',["editor","./list-utils","dom","node","ua"],function(S ,require, exports, module) {function e(e){return e.nodeType===c.NodeType.ELEMENT_NODE&&"li"===c.nodeName(e)}function n(e,n,t){for(var r=e.startContainer,a=e.endContainer;r&&!r.parent().equals(n);)r=r.parent();for(;a&&!a.parent().equals(n);)a=a.parent();if(r&&a){for(var o=r,s=[],N=!1;!N;)o.equals(a)&&(N=!0),s.push(o),o=o.next();if(!(s.length<1)){var p=n._4eParents(!0,void 0);p.each(function(e,n){p[n]=e});for(var v=0;v<p.length;v++)if(l[p[v].nodeName()]){n=p[v];break}var y="indent"===t?1:-1,x=s[0],E=s[s.length-1],g={},C=d.listToArray(n,g),T=C[E.data("listarray_index")].indent;for(v=x.data("listarray_index");v<=E.data("listarray_index");v++){C[v].indent+=y;var k=C[v].parent;C[v].parent=f(k[0].ownerDocument.createElement(k.nodeName()))}for(v=E.data("listarray_index")+1;v<C.length&&C[v].indent>T;v++)C[v].indent+=y;var _,q=d.arrayToList(C,g,null,"p"),M=[];if("outdent"===t&&(_=n.parent())&&"li"===_.nodeName()){var A,L=q.listNode.childNodes,B=L.length;for(v=B-1;v>=0;v--)(A=f(L[v]))&&"li"===A.nodeName()&&M.push(A)}if(q&&(c.insertBefore(q.listNode[0]||q.listNode,n[0]||n),n.remove()),M&&M.length)for(v=0;v<M.length;v++){for(var D=M[v],O=D;(O=O.next())&&O.nodeName()in l;)u.ie&&!D.first(function(e){return m(e)&&h(e)},1)&&D[0].appendChild(e.document.createTextNode("Â ")),D[0].appendChild(O[0]);c.insertAfter(D[0],_[0])}i.Utils.clearAllMarkers(g)}}}function t(e,n){var t,a=e.createIterator();for(a.enforceRealBlocks=!0,a.enlargeBr=!0;t=a.getNextParagraph();)r(t,n)}function r(e,n){var t=parseInt(e.style(N),10);return isNaN(t)&&(t=0),t+=("indent"===n?1:-1)*p,0>t?!1:(t=Math.max(t,0),t=Math.ceil(t/p)*p,e.css(N,t?t+v:""),""===e[0].style.cssText&&e.removeAttr("style"),!0)}function a(a,o){var i=a.getSelection(),d=i&&i.getRanges()[0];if(d){for(var f=d.startContainer,u=d.endContainer,m=d.getCommonAncestor(),N=m;N&&(N[0].nodeType!==c.NodeType.ELEMENT_NODE||!l[N.nodeName()]);)N=N.parent();var p;N&&f[0].nodeType===c.NodeType.ELEMENT_NODE&&f.nodeName()in l&&(p=new s(d),p.evaluator=e,d.startContainer=p.next()),N&&u[0].nodeType===c.NodeType.ELEMENT_NODE&&u.nodeName()in l&&(p=new s(d),p.evaluator=e,d.endContainer=p.previous());var v=i.createBookmarks(!0);if(N){for(var h=N.first();h&&"li"!==h.nodeName();)h=h.next();var y=d.startContainer,x=h[0]===y[0]||h.contains(y);x&&r(N,o)||n(d,N,o)}else t(d,o);i.selectBookmarks(v)}}function o(e,n){e.hasCommand(n)||e.addCommand(n,{exec:function(e){e.execCommand("save"),a(e,n),e.execCommand("save"),e.notifySelectionChange()}})}var i=require("editor"),d=require("./list-utils"),l={ol:1,ul:1},s=i.Walker,c=require("dom"),f=require("node"),u=require("ua"),m=s.whitespaces(!0),N="margin-left",p=40,v="px",h=s.bookmark(!1,!0);module.exports={checkOutdentActive:function(e){var n=e.blockLimit;if(e.contains(l))return!0;var t=e.block||n;return t&&t.style(N)},addCommand:o};});