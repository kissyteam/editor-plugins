KISSY.add('kg/editor-plugins/1.1.0/table/dialog',["util","editor","../dialog","../menubutton","ua","node","dom"],function(S ,require, exports, module) {function e(e,t){return i.substitute(e,{prefixCls:t})}function t(e){return 0!==p(e).length}function l(e){var t=this;t.editor=e,a.Utils.lazyRun(t,"_prepareTableShow","_realTableShow")}var i=require("util"),a=require("editor"),r=require("../dialog"),d=require("../menubutton"),o=require("ua").ieMode<11,s=require("node"),n=require("dom"),p=i.trim,c="ke_show_border",b="k-e-collapse-table",h=6,f="margin:0 5px 0 0;",v='<div style="padding:20px 20px 10px 20px;"><table class="{prefixCls}editor-table-config" style="width:100%"><tr><td><label>行数： <input  data-verify="^(?!0$)\\d+$"  data-warning="行数请输入正整数"  value="2"  class="{prefixCls}editor-table-rows {prefixCls}editor-table-create-only {prefixCls}editor-input" style="'+f+'" size="'+h+'" /></label></td><td><label>宽&nbsp;&nbsp;&nbsp;度： </label> <input  data-verify="^(?!0$)\\d+$"  data-warning="宽度请输入正整数" value="200" style="'+f+'" class="{prefixCls}editor-table-width {prefixCls}editor-input" size="'+h+'"/><select class="{prefixCls}editor-table-width-unit" title="宽度单位"><option value="px">像素</option><option value="%">百分比</option></select></td></tr><tr><td><label>列数： <input  data-verify="^(?!0$)\\d+$"  data-warning="列数请输入正整数" class="{prefixCls}editor-table-cols {prefixCls}editor-table-create-only {prefixCls}editor-input" style="'+f+'"value="3" size="'+h+'"/></label></td><td><label>高&nbsp;&nbsp;&nbsp;度： </label><input  data-verify="^((?!0$)\\d+)?$"  data-warning="高度请输入正整数" value="" style="'+f+'"class="{prefixCls}editor-table-height {prefixCls}editor-input" size="'+h+'"/> &nbsp;像素</td></tr><tr><td><label>对齐： </label><select class="{prefixCls}editor-table-align" title="对齐"><option value="">无</option><option value="left">左对齐</option><option value="right">右对齐</option><option value="center">中间对齐</option></select></td><td><label>标题格：</label> <select class="{prefixCls}editor-table-head {prefixCls}editor-table-create-only" title="标题格"><option value="">无</option><option value="1">有</option></select></td></tr><tr><td><label>边框： <input  data-verify="^\\d+$"  data-warning="边框请输入非负整数" value="1" style="'+f+'"class="{prefixCls}editor-table-border {prefixCls}editor-input" size="'+h+'"/></label> &nbsp;像素 <label><input type="checkbox" style="vertical-align: middle; margin-left: 5px;" class="{prefixCls}editor-table-collapse" /> 合并边框</label></td><td><label class="{prefixCls}editor-table-cellpadding-holder">边&nbsp;&nbsp;&nbsp;距： <input  data-verify="^(\\d+)?$"  data-warning="边框请输入非负整数" value="0" style="'+f+'"class="{prefixCls}editor-table-cellpadding {prefixCls}editor-input" size="'+h+'"/> &nbsp;像素</label></td></tr><tr><td colspan="2"><label>标题： <input class="{prefixCls}editor-table-caption {prefixCls}editor-input" style="width:380px;'+f+'"></label></td></tr></table></div>',u='<div style="padding:5px 20px 20px;"><a class="{prefixCls}editor-table-ok {prefixCls}editor-button ks-inline-block" style="margin-right:20px;">确定</a> <a class="{prefixCls}editor-table-cancel {prefixCls}editor-button ks-inline-block">取消</a></div>',g=a.Utils.addRes,x=a.Utils.destroyRes;i.augment(l,{_tableInit:function(){var t=this,l=t.editor.get("prefixCls"),i=new r({width:"500px",mask:!0,headerContent:"表格",bodyContent:e(v,l),footerContent:e(u,l)}).render(),a=i.get("body"),o=i.get("footer");i.twidth=a.one(e(".{prefixCls}editor-table-width",l)),i.theight=a.one(e(".{prefixCls}editor-table-height",l)),i.tborder=a.one(e(".{prefixCls}editor-table-border",l)),i.tcaption=a.one(e(".{prefixCls}editor-table-caption",l)),i.talign=d.Select.decorate(a.one(e(".{prefixCls}editor-table-align",l)),{prefixCls:e("{prefixCls}editor-big-",l),width:80,menuCfg:{prefixCls:e("{prefixCls}editor-",l),render:a}}),i.trows=a.one(e(".{prefixCls}editor-table-rows",l)),i.tcols=a.one(e(".{prefixCls}editor-table-cols",l)),i.thead=d.Select.decorate(a.one(e(".{prefixCls}editor-table-head",l)),{prefixCls:e("{prefixCls}editor-big-",l),width:80,menuCfg:{prefixCls:e("{prefixCls}editor-",l),render:a}}),i.cellpaddingHolder=a.one(e(".{prefixCls}editor-table-cellpadding-holder",l)),i.cellpadding=a.one(e(".{prefixCls}editor-table-cellpadding",l)),i.tcollapse=a.one(e(".{prefixCls}editor-table-collapse",l));var s=o.one(e(".{prefixCls}editor-table-ok",l)),n=o.one(e(".{prefixCls}editor-table-cancel",l));i.twidthunit=d.Select.decorate(a.one(e(".{prefixCls}editor-table-width-unit",l)),{prefixCls:e("{prefixCls}editor-big-",l),width:80,menuCfg:{prefixCls:e("{prefixCls}editor-",l),render:a}}),t.dialog=i,s.on("click",t._tableOk,t),n.on("click",function(e){e.halt(),i.hide()}),g.call(t,i,i.twidthunit,s,n)},_tableOk:function(e){e.halt();var t=this,l=t.dialog,i=l.get("el").all("input");if("%"===l.twidthunit.get("value")){var r=parseInt(l.twidth.val(),10);if(!r||r>100||0>r)return void alert("宽度百分比：请输入1-100之间")}var d=a.Utils.verifyInputs(i);d&&(t.dialog.hide(),setTimeout(function(){t.selectedTable?t._modifyTable():t._genTable()},0))},_modifyTable:function(){var e=this,l=e.dialog,a=e.selectedTable,r=a.one("caption"),d=l.talign.get("value"),o=l.tborder.val();if(t(d)?a.attr("align",p(d)):a.removeAttr("align"),t(o)?a.attr("border",p(o)):a.removeAttr("border"),t(o)&&"0"!==o?a.removeClass(c,void 0):a.addClass(c,void 0),t(l.twidth.val())?a.css("width",p(l.twidth.val())+l.twidthunit.get("value")):a.css("width",""),t(l.theight.val())?a.css("height",p(l.theight.val())):a.css("height",""),l.tcollapse[0].checked?a.addClass(b,void 0):a.removeClass(b,void 0),l.cellpadding.val(parseInt(l.cellpadding.val(),10)||0),e.selectedTd&&e.selectedTd.css("padding",l.cellpadding.val()),t(l.tcaption.val())){var s=i.escapeHtml(p(l.tcaption.val()));if(r&&r[0])r.html(s);else{var h=a[0].createCaption();n.html(h,"<span>"+s+"</span>")}}else r&&r.remove()},_genTable:function(){var e,l=this,a=l.dialog,r="<table ",d=parseInt(a.tcols.val(),10)||1,n=parseInt(a.trows.val(),10)||1,h=o?"":"<br/>",f=l.editor;t(a.talign.get("value"))&&(r+='align="'+p(a.talign.get("value"))+'" '),t(a.tborder.val())&&(r+='border="'+p(a.tborder.val())+'" ');var v=[];t(a.twidth.val())&&v.push("width:"+p(a.twidth.val())+a.twidthunit.get("value")+";"),t(a.theight.val())&&v.push("height:"+p(a.theight.val())+"px;"),v.length&&(r+='style="'+v.join("")+'" ');var u=[];if(t(a.tborder.val())&&"0"!==String(p(a.tborder.val()))||u.push(c),a.tcollapse[0].checked&&u.push(b),u.length&&(r+='class="'+u.join(" ")+'" '),r+=">",t(a.tcaption.val())&&(r+="<caption><span>"+i.escapeHtml(p(a.tcaption.val()))+"</span></caption>"),a.thead.get("value")){for(r+="<thead>",r+="<tr>",e=0;d>e;e++)r+="<th>"+h+"</th>";r+="</tr>",r+="</thead>",n-=1}r+="<tbody>";for(var g=0;n>g;g++){for(r+="<tr>",e=0;d>e;e++)r+="<td>"+h+"</td>";r+="</tr>"}r+="</tbody>",r+="</table>";var x=s(r,f.get("document")[0]);f.insertElement(x)},_fillTableDialog:function(){var e=this,t=e.dialog,l=e.selectedTable,i=l.one("caption");e.selectedTd&&t.cellpadding.val(parseInt(e.selectedTd.css("padding"),10)||"0"),t.talign.set("value",l.attr("align")||""),t.tborder.val(l.attr("border")||"0");var a=l.style("width")||""+l.width();t.tcollapse[0].checked=l.hasClass(b,void 0),t.twidth.val(a.replace(/px|%|(.*pt)/i,"")),-1!==a.indexOf("%")?t.twidthunit.set("value","%"):t.twidthunit.set("value","px"),t.theight.val((l.style("height")||"").replace(/px|%/i,""));var r="";i&&(r=i.text()),t.tcaption.val(r);var d=l.first("thead"),o=(l.one("tbody")?l.one("tbody").children().length:0)+(d?d.children("tr").length:0);t.trows.val(o),t.tcols.val(l.one("tr")?l.one("tr").children().length:0),t.thead.set("value",d?"1":"")},_realTableShow:function(){var t=this,l=t.editor.get("prefixCls"),i=t.dialog;t.selectedTable?(t._fillTableDialog(),i.get("el").all(e(".{prefixCls}editor-table-create-only",l)).attr("disabled","disabled"),i.thead.set("disabled",!0)):(i.get("el").all(e(".{prefixCls}editor-table-create-only",l)).removeAttr("disabled"),i.thead.set("disabled",!1)),t.selectedTd?i.cellpaddingHolder.show():i.cellpaddingHolder.hide(),t.dialog.show()},_prepareTableShow:function(){var e=this;e._tableInit()},show:function(e){var t=this;i.mix(t,e),t._prepareTableShow()},destroy:function(){x.call(this)}}),module.exports=l;});