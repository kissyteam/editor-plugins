KISSY.add('kg/editor-plugins/1.1.0/fake-objects',["editor","html-parser","util","node","dom"],function(S ,require, exports, module) {var e=require("editor"),t=require("html-parser"),r=require("util"),i=require("node"),a=require("dom"),l=e.Utils,n=l.debugUrl("theme/spacer.gif");e.addMembers({createFakeElement:function(e,t,a,l,s,_){var d=e.attr("style")||"";e.attr("width")&&(d="width:"+e.attr("width")+"px;"+d),e.attr("height")&&(d="height:"+e.attr("height")+"px;"+d);var u=this,o=r.trim(e.attr("class")),h={"class":t+" "+o,src:n,_ke_real_element:encodeURIComponent(s||e.outerHtml()),_ke_real_node_type:e[0].nodeType,style:d};return _&&(delete _.width,delete _.height,r.mix(h,_,!1)),a&&(h._ke_real_element_type=a),l&&(h._ke_resizable=l),new i("<img/>",h,u.get("document")[0])},restoreRealElement:function(e){if(parseInt(e.attr("_ke_real_node_type"),10)!==a.NodeType.ELEMENT_NODE)return null;var t=r.urlDecode(e.attr("_ke_real_element")),l=i("<div>",this.get("document")[0]);return l.html(t),l.first().remove()}});var s={tags:{$:function(e){var i,a=e.getAttribute("_ke_real_element");a&&(i=new t.Parser(r.urlDecode(a)).parse());var l=i&&i.childNodes[0];if(l){var n=e.getAttribute("style");if(n){var s=/(?:^|\s)width\s*:\s*(\d+)/i.exec(n),_=s&&s[1];s=/(?:^|\s)height\s*:\s*(\d+)/i.exec(n);var d=s&&s[1];_&&l.setAttribute("width",_),d&&l.setAttribute("height",d)}return l}}}};module.exports={init:function(e){var l=e.htmlDataProcessor,_=l&&l.htmlFilter;l.createFakeParserElement||(_&&_.addRules(s),r.mix(l,{restoreRealElement:function(t){if(parseInt(t.attr("_ke_real_node_type"),10)!==a.NodeType.ELEMENT_NODE)return null;var l=r.urlDecode(t.attr("_ke_real_element")),n=i("<div>",e.get("document")[0]);return n.html(l),n.first().remove()},createFakeParserElement:function(e,i,a,l,s){var _=t.serialize(e),d=e.getAttribute("style")||"";e.getAttribute("width")&&(d="width:"+e.getAttribute("width")+"px;"+d),e.getAttribute("height")&&(d="height:"+e.getAttribute("height")+"px;"+d);var u=r.trim(e.getAttribute("class")),o={"class":i+" "+u,src:n,_ke_real_element:encodeURIComponent(_),_ke_real_node_type:e.nodeType+"",style:d,align:e.getAttribute("align")||""};return s&&(delete s.width,delete s.height,r.mix(o,s,!1)),a&&(o._ke_real_element_type=a),l&&(o._ke_resizable="_ke_resizable"),new t.Tag("img",o)}}))}};});