KISSY.add('kg/editor-plugins/1.1.0/word-filter',["html-parser","util","node","ua"],function(S ,require, exports, module) {function e(e){e=e.toUpperCase();for(var t=w.length,i=0,r=0;t>r;++r)for(var n=w[r],l=n[1].length;e.substr(0,l)===n[1];e=e.substr(l))i+=n[0];return i}function t(e){e=e.toUpperCase();for(var t=x.length,i=1,r=1;e.length>0;r*=t)i+=x.indexOf(e.charAt(e.length-1))*r,e=e.substr(0,e.length-1);return i}function i(e,t){t?e.setAttribute("style",t):e.removeAttribute("style")}function r(e){var t=e.childNodes||[],i=t.length,r=1===i&&t[0];return r||null}function n(e,t){for(var i,r=e.childNodes||[],l=[],a=0;a<r.length;a++)i=r[a],i.nodeName&&(i.nodeName===t&&(l.push(i),r.splice(a--,1)),l=l.concat(n(i,t)));return l}function l(e,t){for(var i=e.parentNode;i&&(!i.nodeName||!i.nodeName.match(t));)i=i.parentNode;return i}function a(e,t){var i,r,n=e.childNodes||[];for(r=0;r<n.length;r++){if(i=n[r],t(i))return i;if(i.nodeName&&(i=a(i,t)))return i}return null}function s(e,t,r,n){var l,a,s="";if("string"==typeof r)s+=t+":"+r+";";else{if("object"==typeof t)for(a in t)s+=a+":"+t[a]+";";else s+=t;n=r}l=e.getAttribute("style"),l=(n?[s,l]:[l,s]).join(";"),i(e,l.replace(/^;|;(?=;)/,""))}function o(e){var t,i={};for(t in p)-1===t.indexOf("$")&&p[t][e]&&(i[t]=1);return i}function u(e){var t,r,n,l=e.childNodes||[],a=l.length,o=/list-style-type:(.*?)(?:;|$)/,u=S.stylesFilter;if(!o.exec(e.getAttribute("style"))){for(var c=0;a>c;c++)if(t=l[c],t.getAttribute("value")&&Number(t.getAttribute("value"))===c+1&&t.removeAttribute("value"),r=o.exec(t.getAttribute("style"))){if(r[1]!==n&&n){n=null;break}n=r[1]}if(n){for(c=0;a>c;c++){var f=l[c].getAttribute("style");f&&(f=u([["list-style-type"]])(f),i(l[c],f))}s(e,"list-style-type",n)}}}var c,f=require("html-parser"),d=require("util"),m=require("node"),g=require("ua"),p=f.DTD,h=new f.Filter,b=/^([.\d]*)+(em|ex|px|gd|rem|vw|vh|vm|ch|mm|cm|in|pt|pc|deg|rad|ms|s|hz|khz){1}?/i,v=/^(?:\b0[^\s]*\s*){1,4}$/,y="^m{0,4}(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})$",A=new RegExp(y),N=new RegExp(y.toUpperCase()),k={decimal:/\d+/,"lower-roman":A,"upper-roman":N,"lower-alpha":/^[a-z]+$/,"upper-alpha":/^[A-Z]+$/},$={disc:/[l\u00B7\u2002]/,circle:/[\u006F\u00D8]/,square:/[\u006E\u25C6]/},C={ol:k,ul:$},w=[[1e3,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]],x="ABCDEFGHIJKLMNOPQRSTUVWXYZ",T=function(){var e;return function(t){return e||(e=m('<div style="position:absolute;left:-9999px;top:-9999px;margin:0px;padding:0px;border:0px;"></div>').prependTo("body")),/%$/.test(t)?t:(e.css("width",t),e[0].clientWidth)}}(),L=0,F=null,S={flattenList:function(e,t){t="number"==typeof t?t:1;var i;switch(e.getAttribute("type")){case"a":i="lower-alpha";break;case"1":i="decimal"}for(var r,n=e.childNodes||[],l=0;l<n.length;l++)if(r=n[l],r.nodeName in p.$listItem){var a=r.childNodes||[],s=a.length,o=a[s-1];o.nodeName in p.$list&&(e.insertAfter(r),--a.length||e.removeChild(n[l--])),r.setTagName("ke:li"),e.getAttribute("start")&&!l&&e.setAttribute("value",e.getAttribute("start")),S.stylesFilter([["tab-stops",null,function(e){var t=e.split(" ")[1].match(b);t&&(F=T(t[0]))}],1===t?["mso-list",null,function(e){e=e.split(" ");var t=Number(e[0].match(/\d+/));t!==c&&r.setAttribute("ke:reset",1),c=t}]:null])(r.getAttribute("style")),r.setAttribute("ke:indent",t),r.setAttribute("ke:listtype",e.nodeName),r.setAttribute("ke:list-style-type",i)}else if(r.nodeName in p.$list){arguments.callee.apply(this,[r,t+1]),n=n.slice(0,l).concat(r.childNodes).concat(n.slice(l+1)),e.empty();for(var u=0,f=n.length;f>u;u++)e.appendChild(n[u])}e.nodeName=e.tagName=null,e.setAttribute("ke:list",1)},assembleList:function(i){for(var r,n,l,a,o,c,m,g,p,h,b,v,y=i.childNodes||[],A=[],N=0;N<y.length;N++)if(r=y[N],"ke:li"===r.nodeName){if(r.setTagName("li"),n=r,p=n.getAttribute("ke:listsymbol"),p=p&&p.match(/^(?:[(]?)([^\s]+?)([.)]?)$/),h=b=v=null,n.getAttribute("ke:ignored")){y.splice(N--,1);continue}if(n.getAttribute("ke:reset")&&(c=a=o=null),l=Number(n.getAttribute("ke:indent")),l!==a&&(g=m=null),p){if(g&&C[g][m].test(p[1]))h=g,b=m;else for(var k in C)for(var $ in C[k])if(C[k][$].test(p[1])){if("ol"!==k||!/alpha|roman/.test($)){h=k,b=$;break}var w=/roman/.test($)?e(p[1]):t(p[1]);(!v||v>w)&&(v=w,h=k,b=$)}h||(h=p[2]?"ol":"ul")}else h=n.getAttribute("ke:listtype")||"ol",b=n.getAttribute("ke:list-style-type");if(g=h,m=b||("ol"===h?"decimal":"disc"),b&&b!==("ol"===h?"decimal":"disc")&&s(n,"list-style-type",b),"ol"===h&&p){switch(b){case"decimal":v=Number(p[1]);break;case"lower-roman":case"upper-roman":v=e(p[1]);break;case"lower-alpha":case"upper-alpha":v=t(p[1])}n.setAttribute("value",v)}if(c){if(l>a)A.push(c=new f.Tag(h)),c.appendChild(n),o.appendChild(c);else if(a>l){for(var x,T=a-l;T--&&(x=c.parentNode);)c=x.parentNode;c.appendChild(n)}else c.appendChild(n);y.splice(N--,1)}else A.push(c=new f.Tag(h)),c.appendChild(n),i.replaceChild(c,y[N]);o=n,a=l}else c&&(3!==r.nodeType||d.trim(r.nodeValue))&&(c=a=o=null);for(N=0;N<A.length;N++)u(A[N])},falsyFilter:function(){return!1},stylesFilter:function(e,t){return function(i,r){var n=[];(i||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(i,l,a){l=l.toLowerCase(),"font-family"===l&&(a=a.replace(/['']/g,""));for(var s,o,u,c,f=0;f<e.length;f++)if(e[f]&&(s=e[f][0],o=e[f][1],u=e[f][2],c=e[f][3],l.match(s)&&(!o||a.match(o))))return l=c||l,t&&(u=u||a),"function"==typeof u&&(u=u(a,r,l)),u&&u.push&&(l=u[0],u=u[1]),void("string"==typeof u&&n.push([l,u]));t||n.push([l,a])});for(var l=0;l<n.length;l++)n[l]=n[l].join(":");return n.length?n.join(";")+";":!1}},applyStyleFilter:null},D={createListBulletMarker:function(e,t){var i=new f.Tag("ke:listbullet");return i.setAttribute("ke:listsymbol",e[0]),i.appendChild(new f.Text(t)),i},isListBulletIndicator:function(e){var t=e.getAttribute("style");return/mso-list\s*:\s*Ignore/i.test(t)?!0:void 0},isContainingOnlySpaces:function(e){var t;return(t=r(e))&&/^(:?\s|&nbsp;)+$/.test(t.nodeValue)},resolveList:function(e){var t;if((t=n(e,"ke:listbullet"))&&t.length&&(t=t[0])){if(e.setTagName("ke:li"),e.getAttribute("style")){var r=S.stylesFilter([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(t){var i=t.split(" ");t=T(i[3]||i[1]||i[0]),!L&&null!==F&&t>F&&(L=t-F),F=t,L&&e.setAttribute("ke:indent",L&&Math.ceil(t/L)+1||1)}],[/^mso-list$/,null,function(t){t=t.split(" ");var i=Number(t[0].match(/\d+/)),r=Number(t[1].match(/\d+/));1===r&&(i!==c&&e.setAttribute("ke:reset",1),c=i),e.setAttribute("ke:indent",r)}]])(e.getAttribute("style"),e);i(e,r)}return e.getAttribute("ke:indent")||(F=0,e.setAttribute("ke:indent",1)),d.each(t.attributes,function(t){e.setAttribute(t.name,t.value)}),!0}return c=F=L=null,!1},getStyleComponents:function(){var e=m('<div style="position:absolute;left:-9999px;top:-9999px;"></div>').prependTo("body");return function(t,i,r){e.css(t,i);for(var n={},l=r.length,a=0;l>a;a++)n[r[a]]=e.css(r[a]);return n}}(),listDtdParents:o("ol")};!function(){var e=d.merge(p.$block,p.$listItem,p.$tableContent),t=S.falsyFilter,n=S.stylesFilter,o=D.createListBulletMarker,u=S.flattenList,c=S.assembleList,m=D.isListBulletIndicator,b=D.isContainingOnlySpaces,y=D.resolveList,A=function(e){return e=T(e),isNaN(e)?e:e+"px"},N=D.getStyleComponents,k=D.listDtdParents;h.addRules({tagNames:[[/meta|link|script/,""]],root:function(e){e.filterChildren(),c(e)},tags:{"^":function(e){var t;g.gecko&&(t=S.applyStyleFilter)&&t(e)},$:function(t){var r=t.nodeName||"";if(r in e&&t.getAttribute("style")&&i(t,n([[/^(:?width|height)$/,null,A]])(t.getAttribute("style"))),r.match(/h\d/)){if(t.filterChildren(),y(t))return}else if(r in p.$inline)t.filterChildren(),b(t)&&t.setTagName(null);else if(-1!==r.indexOf(":")&&-1===r.indexOf("ke")){if(t.filterChildren(),"v:imagedata"===r){var l=t.getAttribute("o:href");return l&&t.setAttribute("src",l),void t.setTagName("img")}t.setTagName(null)}r in k&&(t.filterChildren(),c(t))},style:function(e){if(g.gecko){var t=r(e).nodeValue.match(/\/\* Style Definitions \*\/([\s\S]*?)\/\*/),i=t&&t[1],n={};i&&(i.replace(/[\n\r]/g,"").replace(/(.+?)\{(.+?)\}/g,function(e,t,i){t=t.split(",");for(var r=t.length,l=0;r>l;l++)d.trim(t[l]).replace(/^(\w+)(\.[\w-]+)?$/g,function(e,t,r){t=t||"*",r=r.substring(1,r.length),r.match(/MsoNormal/)||(n[t]||(n[t]={}),r?n[t][r]=i:n[t]=i)})}),S.applyStyleFilter=function(e){var t,i=n["*"]?"*":e.nodeName,r=e.getAttribute("class");i in n&&(t=n[i],"object"==typeof t&&(t=t[r]),t&&s(e,t,!0))})}return!1},p:function(e){if(/MsoListParagraph/.exec(e.getAttribute("class"))){var t=a(e,function(e){return 3===e.nodeType&&!b(e.parentNode)}),i=t&&t.parentNode;i&&!i.getAttribute("style")&&i.setAttribute("style","mso-list: Ignore;")}e.filterChildren(),y(e)},div:function(e){var t=r(e);if(t&&"table"===t.nodeName){var i=e.attributes;d.each(i,function(e){t.setAttribute(e.name,e.value)}),e.getAttribute("style")&&s(t,e.getAttribute("style"));var n=new f.Tag("div");s(n,"clear","both"),e.appendChild(n),e.setTagName(null)}},td:function(e){l(e,"thead")&&e.setTagName("th")},ol:u,ul:u,dl:u,font:function(e){if(m(e.parentNode))return void e.setTagName(null);e.filterChildren();var t=e.getAttribute("style"),i=e.parentNode;if("font"===i.name)d.each(e.attributes,function(e){i.setAttribute(e.name,e.value)}),t&&s(i,t),e.setTagName(null);else{t=t||"",e.getAttribute("color")&&("#000000"!==e.getAttribute("color")&&(t+="color:"+e.getAttribute("color")+";"),e.removeAttribute("color")),e.getAttribute("face")&&(t+="font-family:"+e.getAttribute("face")+";",e.removeAttribute("face"));var r=e.getAttribute("size");r&&(t+="font-size:"+(r>3?"large":3>r?"small":"medium")+";",e.removeAttribute("size")),e.setTagName("span"),s(e,t)}},span:function(e){if(m(e.parentNode))return!1;if(e.filterChildren(),b(e))return e.setTagName(null),null;if(m(e)){var t=a(e,function(e){return e.nodeValue||"img"===e.nodeName}),r=t&&(t.nodeValue||"l."),s=r&&r.match(/^(?:[(]?)([^\s]+?)([.)]?)$/);if(s){var u=o(s,r),c=l(e,"span");return c&&/ mso-hide:\s*all|display:\s*none /.test(c.getAttribute("style"))&&u.setAttribute("ke:ignored",1),u}}var f=e.getAttribute("style");f&&i(e,n([[/^line-height$/],[/^font-family$/],[/^font-size$/],[/^color$/],[/^background-color$/]])(f,e))},a:function(e){var t;!(t=e.getAttribute("href"))&&e.getAttribute("name")?e.setTagName(null):g.webkit&&t&&t.match(/file:\/\/\/[\S]+#/i)&&e.setAttribute("href",t.replace(/file:\/\/\/[^#]+/i,""))},"ke:listbullet":function(e){l(e,/h\d/)&&e.setTagName(null)}},attributeNames:[[/^onmouse(:?out|over)/,""],[/^onload$/,""],[/(?:v|o):\w+/,""],[/^lang/,""]],attributes:{style:n([[/^list-style-type$/],[/^margin$|^margin-(?!bottom|top)/,null,function(e,t,i){if(t.nodeName in{p:1,div:1}){var r="margin-left";if("margin"===i)e=N(i,e,[r])[r];else if(i!==r)return null;if(e&&!v.test(e))return[r,e]}return null}],[/^clear$/],[/^border.*|margin.*|vertical-align|float$/,null,function(e,t){return"img"===t.nodeName?e:void 0}],[/^width|height$/,null,function(e,t){return t.nodeName in{table:1,td:1,th:1,img:1}?e:void 0}]],1),width:function(e,t){return t.nodeName in p.$tableContent?!1:void 0},border:function(e,t){return t.nodeName in p.$tableContent?!1:void 0},"class":t,bgcolor:t,valign:function(e,t){return s(t,"vertical-align",e),!1}},comment:g.ie?function(e,t){var i=e.match(/<img.*?>/),r=e.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);if(r){var n=r[1]||i&&"l.",l=n&&n.match(/>(?:[(]?)([^\s]+?)([.)]?)</);return o(l,n)}if(g.gecko&&i){var a=new f.Parser(i[0]).parse().childNodes[0],s=t.previousSibling,u=s&&s.toHtml().match(/<v:imagedata[^>]*o:href=[''](.*?)['']/),c=u&&u[1];return c&&a.setAttribute("src",c),a}return!1}:t})}(),module.exports={toDataFormat:function(e,t){return g.gecko&&(e=e.replace(/(<!--\[if[^<]*?\])-->([\S\s]*?)<!--(\[endif\]-->)/gi,"$1$2$3")),e=t.htmlDataProcessor.toDataFormat(e,h)}};});