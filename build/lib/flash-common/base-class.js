/*
Copyright 2014, KISSY v5.0.0
MIT Licensed
build time: Jul 18 13:57
*/
KISSY.add("editor-plugins/lib/flash-common/base-class","./utils,base,editor,node,ua,util,../dialog-loader,../bubble,../contextmenu".split(","),function(c,a,n,f){var g=a("./utils"),c=a("base"),j=a("editor"),k=a("node"),l=a("ua"),i=a("util"),m=a("../dialog-loader");a("../bubble");a("../contextmenu");f.exports=c.extend({initializer:function(){var b=this,e=b.get("cls"),d=b.get("editor"),a=d.get("prefixCls"),c=[],f=b.get("bubbleId"),g=b.get("contextMenuId"),h=b.get("contextMenuHandlers");i.each(h,function(b,
a){c.push({content:a})});d.addContextMenu(g,"."+e,{width:"120px",children:c,listeners:{click:function(b){b=b.target.get("content");h[b]&&h[b].call(this)}}});d.addBubble(f,function(b){return b.hasClass(e,void 0)&&b},{listeners:{afterRenderUI:function(){var e=this,c=e.get("contentEl");c.html(i.substitute(' <a class="{prefixCls}editor-bubble-url" target="_blank" href="#">{label}</a>   |    <span class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-change">\u7f16\u8f91</span>   |    <span class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-remove">\u5220\u9664</span>',
{label:b.get("label"),prefixCls:a}));var f=c.one("."+a+"editor-bubble-url"),g=c.one("."+a+"editor-bubble-change"),h=c.one("."+a+"editor-bubble-remove");j.Utils.preventFocus(c);g.on("click",function(a){b.show(e.get("editorSelectedEl"));a.halt()});h.on("click",function(b){if(l.webkit){var a=d.getSelection().getRanges();if(a=a&&a[0]){a.collapse(true);a.select()}}e.get("editorSelectedEl").remove();e.hide();d.notifySelectionChange();b.halt()});e.on("show",function(){var a=e.get("editorSelectedEl");a&&
b._updateTip(f,a)})}}});d.docReady(function(){d.get("document").on("dblclick",b._dbClick,b)})},_getFlashUrl:function(b){return g.getUrl(b)},_updateTip:function(b,a){var d=this.get("editor").restoreRealElement(a);if(d){d=this._getFlashUrl(d);b.attr("href",d)}},_dbClick:function(b){var a=k(b.target);if(a.nodeName()==="img"&&a.hasClass(this.get("cls"),void 0)){this.show(a);b.halt()}},show:function(a){var c=this.get("editor");m.useDialog(c,this.get("type"),this.get("pluginConfig"),a)}},{ATTRS:{cls:{},
type:{},label:{value:"\u5728\u65b0\u7a97\u53e3\u67e5\u770b"},bubbleId:{},contextMenuId:{},contextMenuHandlers:{}}})});
