KISSY.add('kg/editor-plugins/1.1.2/list-utils',["node","dom","ua"],function(S ,require, exports, module) {var e={ol:1,ul:1},n=require("node"),t=require("dom"),r=t.NodeType,a=require("ua"),d={listToArray:function(r,a,o,l,i){if(!e[r.nodeName()])return[];l||(l=0),o||(o=[]);for(var p=0,N=r[0].childNodes.length;N>p;p++){var s=n(r[0].childNodes[p]);if("li"===s.nodeName()){var u={parent:r,indent:l,element:s,contents:[]};i?u.grandparent=i:(u.grandparent=r.parent(),u.grandparent&&"li"===u.grandparent.nodeName()&&(u.grandparent=u.grandparent.parent())),a&&s._4eSetMarker(a,"listarray_index",o.length,void 0),o.push(u);for(var h,m=0,c=s[0].childNodes.length;c>m;m++)h=n(s[0].childNodes[m]),h[0].nodeType===t.NodeType.ELEMENT_NODE&&e[h.nodeName()]?d.listToArray(h,a,o,l+1,u.grandparent):u.contents.push(h)}}return o},arrayToList:function(o,l,i,p){if(i||(i=0),!o||o.length<i+1)return null;for(var N,s=o[i].parent[0].ownerDocument,u=s.createDocumentFragment(),h=null,m=i,c=Math.max(o[i].indent,0),E=null;;){var T=o[m];if(T.indent===c){for(h&&o[m].parent.nodeName()===h.nodeName()||(h=o[m].parent.clone(!1),u.appendChild(h[0])),E=h[0].appendChild(T.element.clone(!1)[0]),N=0;N<T.contents.length;N++)E.appendChild(T.contents[N].clone(!0)[0]);m++}else if(T.indent===Math.max(c,0)+1){var g=d.arrayToList(o,null,m,p);E.appendChild(g.listNode),m=g.nextIndex}else{if(-1!==T.indent||i||!T.grandparent)return null;for(e[T.grandparent.nodeName()]?E=T.element.clone(!1)[0]:"td"!==T.grandparent.nodeName()?(E=s.createElement(p),T.element._4eCopyAttributes(n(E))):E=s.createDocumentFragment(),N=0;N<T.contents.length;N++){var f=T.contents[N].clone(!0);E.nodeType===r.DOCUMENT_FRAGMENT_NODE&&T.element._4eCopyAttributes(n(f)),E.appendChild(f[0])}if(E.nodeType===r.DOCUMENT_FRAGMENT_NODE&&m!==o.length-1&&(E.lastChild&&E.lastChild.nodeType===t.NodeType.ELEMENT_NODE&&"_moz"===E.lastChild.getAttribute("type")&&t._4eRemove(E.lastChild),t._4eAppendBogus(E)),E.nodeType===t.NodeType.ELEMENT_NODE&&t.nodeName(E)===p&&E.firstChild){t._4eTrim(E);var y=E.firstChild;if(y.nodeType===t.NodeType.ELEMENT_NODE&&t._4eIsBlockBoundary(y)){var _=s.createDocumentFragment();t._4eMoveChildren(E,_),E=_}}var C=t.nodeName(E);a.ie||"div"!==C&&"p"!==C||t._4eAppendBogus(E),u.appendChild(E),h=null,m++}if(o.length<=m||Math.max(o[m].indent,0)<c)break}if(l)for(var v=n(u.firstChild);v&&v[0];)v[0].nodeType===t.NodeType.ELEMENT_NODE&&v._4eClearMarkers(l,!0),v=v._4eNextSourceNode();return{listNode:u,nextIndex:m}}};module.exports=d;});